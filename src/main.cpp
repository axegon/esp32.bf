#include <Arduino.h>

const int MEMORY_SIZE = 30000;

byte memory[MEMORY_SIZE] = {0};
byte *ptr = memory;

void brainfuckInterpreter(String code) {
  int codeLength = code.length();
  for (int i = 0; i < codeLength; i++) {
    switch (code[i]) {
    case '>':
      ++ptr;
      break;
    case '<':
      --ptr;
      break;
    case '+':
      ++(*ptr);
      break;
    case '-':
      --(*ptr);
      break;
    case '.':
      Serial.write(*ptr);
      break;
    case ',':
      if (Serial.available() > 0) {
        *ptr = Serial.read();
      }
      break;
    case '[':
      if (!*ptr) {
        int loop = 1;
        while (loop > 0) {
          i++;
          if (code[i] == '[')
            loop++;
          if (code[i] == ']')
            loop--;
        }
      }
      break;
    case ']':
      if (*ptr) {
        int loop = 1;
        while (loop > 0) {
          i--;
          if (code[i] == '[')
            loop--;
          if (code[i] == ']')
            loop++;
        }
      }
      break;
    }
  }
}

void setup() {
  Serial.begin(115200);
  vTaskDelay(1000);
  String bfCode = "----[---->+<]>++.\
  --[----->+<]>.+[---->+<]>+++.+[->+++<]>+.\
  --[--->+<]>-.--------.-----------.\
  --[->+++<]>.[->+++<]>+.--[--->+<]>--.\
  +[---->+<]>+++.-[--->++<]>-.+++++++++++.\
  [---->+<]>+++.+[----->+<]>.------------.\
  +[--->+<]>+++.-[---->+<]>++.---[->++++<]>-\
  .----.++++++.-------.----------.[->+++<]>.\
  ------------.---[->++++<]>.------------.+.\
  ++++++++++.+[---->+<]>+++.-[--->++<]>-.\
  ++++++++++.+[---->+<]>+++.[->+++<]>+.\
  -[->+++<]>.[-->+++++<]>.-.[----->+<]>.\
  -[-->+<]>-.+[->+++<]>++.[--->+<]>+.\
  --[->+++<]>-.++++++++++++.+++.----.\
  -------.--[--->+<]>-.---[->++++<]>.\
  ------------.-------.--[--->+<]>-.\
  [---->+<]>+++.+[----->+<]>.----.--.\
  +.++++++++++++.[---->+<]>+++.\
  ---[->++++<]>-.---.-------.+++++++++.\
  +++[->+++<]>++.+++++++++++.[++>---<]>--.\
  -[--->++<]>-.+++++.++++++.-----.\
  [--->+<]>-----.---[->++++<]>-.----.--.\
  --------.[--->+<]>---.------------.+.\
  +++++.-------.-[--->+<]>--.[->+++<]>++.\
  +++++++.--..--.+++++++++++++.[-->+++++<]>+++.\
  [->+++<]>++.[--->+<]>-.-.[---->+<]>+++.\
  --[->++++<]>-.[->+++<]>.---[->+++<]>+.\
  ---[->+++<]>..[++>---<]>--.---[->++++<]>-.\
  ++++[->+++<]>..[->+++<]>-.";
  brainfuckInterpreter(bfCode);
}

void loop() {}